<div class="d-flex justify-content-center align-items-center min-vh-100 wrapper">
    <div class="mx-auto" style="max-width: 400px; width: 100%;">
        <ad-card padding="large" shadow="medium" borderRadius="xl" styleClass="login-card text-center">

            <div class="mb-4">
                <img [src]="userProfile?.profileImageUrl || 'assets/images/placeholder-avatar.png'"
                    class="mb-3 rounded-circle"
                    style="height: 80px; width: 80px; object-fit: cover; border: 2px solid var(--primary-color);">
                <h4>{{ 'auth.passkey.welcomeBack' | translate: {name: userProfile?.firstName || 'User'} }}</h4>
                <p class="text-secondary small">{{ 'auth.passkey.subtitle' | translate }}</p>
            </div>

            <!-- Mode Switcher -->
            <div class="d-flex justify-content-center gap-3 mb-4">
                <div (click)="switchMode('pin')" [class.active-mode]="mode === 'pin'"
                    class="mode-selector p-2 cursor-pointer">
                    <i class="fa-solid fa-th"></i> PIN
                </div>
                <div (click)="switchMode('pattern')" [class.active-mode]="mode === 'pattern'"
                    class="mode-selector p-2 cursor-pointer">
                    <i class="fa-solid fa-draw-polygon"></i> Pattern
                </div>
            </div>

            <p-message *ngIf="errorMessage" severity="error" [text]="errorMessage" class="mb-3 d-block"></p-message>

            <!-- PIN MODE -->
            <div *ngIf="mode === 'pin'" class="pin-container">
                <!-- Dots display -->
                <div class="d-flex justify-content-center gap-3 mb-4" style="height: 20px;">
                    <div *ngFor="let i of [1,2,3,4,5,6]" class="pin-dot" [class.filled]="pinValue.length >= i"></div>
                </div>

                <!-- Keypad -->
                <div class="keypad-grid">
                    <button *ngFor="let num of [1,2,3,4,5,6,7,8,9]" class="keypad-btn"
                        (click)="onDigitClick(num)">{{num}}</button>
                    <div class="empty"></div>
                    <button class="keypad-btn" (click)="onDigitClick(0)">0</button>
                    <button class="keypad-btn text-danger" (click)="onDelete()">
                        <i class="fa-solid fa-backspace"></i>
                    </button>
                </div>
            </div>

            <!-- PATTERN MODE -->
            <div *ngIf="mode === 'pattern'" class="pattern-container d-flex justify-content-center mb-4">
                <canvas #patternCanvas (mousedown)="startDrawing($event)" (touchstart)="startDrawing($event)"
                    (mouseup)="stopDrawing()" (touchend)="stopDrawing()" (mousemove)="handleMove($event)"
                    (touchmove)="handleMove($event)"
                    style="touch-action: none; cursor: crosshair; background: var(--surface-ground); border-radius: 10px;">
                </canvas>
            </div>

            <div class="mt-4">
                <ad-button label="Usa Account Diverso" [outlined]="true" size="small" (onClick)="cancel()">
                </ad-button>
            </div>

        </ad-card>
    </div>
</div>