<div class="chatbot-container">
    <!-- Sidebar -->
    <div class="sidebar" [class.open]="isSidebarOpen">
        <div class="sidebar-header">
            <h3>{{ 'CHATBOT.HISTORY' | translate }}</h3>
            <button class="close-sidebar-btn" (click)="toggleSidebar()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="history-list">
            <div class="history-item" *ngFor="let session of chatHistory?.sessions" (click)="loadSession(session)"
                [class.active]="currentSession?.id === session.id">
                <div class="history-title">{{ session.title }}</div>
                <div class="history-date">{{ session.date | date : 'shortDate' }}</div>
            </div>
        </div>
        <div class="new-chat-btn-container">
            <ad-button [label]="'CHATBOT.NEW_CHAT' | translate" icon="fa-solid fa-plus" (click)="startNewChat()"
                class="w-100"></ad-button>
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-chat">
        <div class="chat-header">
            <button class="sidebar-toggle-btn" (click)="toggleSidebar()">
                <i class="fa-solid fa-bars"></i>
            </button>
            <h2>{{ 'CHATBOT.TITLE' | translate }}</h2>
        </div>

        <div class="messages-container" #scrollContainer>
            <div class="message" *ngFor="let msg of currentSession?.messages"
                [class.user-message]="msg.sender === 'user'" [class.bot-message]="msg.sender === 'bot'">
                <div class="message-content">
                    {{ msg.text }}
                </div>
                <div class="message-time">
                    {{ msg.timestamp | date : 'shortTime' }}
                </div>
            </div>
            <div *ngIf="isTyping" class="message bot-message typing-indicator">
                <div class="message-content">
                    <i class="fa-solid fa-ellipsis fa-fade"></i>
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="suggestions" *ngIf="chatHistory?.suggestions?.length">
                <div class="suggestion-tag" *ngFor="let suggestion of chatHistory?.suggestions"
                    (click)="useSuggestion(suggestion)">
                    {{ suggestion }}
                </div>
            </div>

            <div class="input-wrapper">
                <ad-input [placeholder]="'CHATBOT.PLACEHOLDER' | translate" [(ngModel)]="userMessage"
                    (keyup.enter)="sendMessage()" class="flex-grow-1"></ad-input>

                <button class="voice-btn" (click)="toggleVoiceDictation()" [class.listening]="isListening">
                    <i class="fa-solid fa-microphone" *ngIf="!isListening"></i>
                    <i class="fa-solid fa-microphone-lines fa-beat" *ngIf="isListening"></i>
                </button>

                <ad-button icon="fa-solid fa-paper-plane" (click)="sendMessage()" [disabled]="!userMessage.trim()"
                    [transparent]="true"></ad-button>
            </div>
        </div>
    </div>
</div>