<header class="app-headbar">
    <div class="headbar-left">
        <div class="brand" (click)="goHome()">
            <span class="brand-title">Pay Peek</span>
        </div>
    </div>

    <div class="headbar-right">
        <div class="position-relative d-inline-block">
            <button class="icon-button me-2" type="button" (click)="openNotifications()">
                <i class="fas fa-bell"></i>
                <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
            </button>

            <!-- Notification Dropdown -->
            <div *ngIf="showNotifications" class="notification-dropdown shadow-sm border">
                <div class="dropdown-header d-flex justify-content-between align-items-center p-2 border-bottom">
                    <span class="fw-bold small">Notifiche</span>
                    <button type="button" class="btn-close btn-close-white small" aria-label="Close"
                        (click)="closeNotifications()" style="font-size: 0.7rem;"></button>
                </div>
                <div class="reminders-list" style="max-height: 60vh; overflow-y: auto;">
                    <ng-container *ngIf="reminders.length > 0; else noReminders">
                        <app-monthly-reminder *ngFor="let reminder of reminders" [reminder]="reminder"
                            class="d-block border-bottom"></app-monthly-reminder>
                    </ng-container>
                    <ng-template #noReminders>
                        <div class="p-3 text-center text-muted">
                            <small>Nessun promemoria disponibile.</small>
                        </div>
                    </ng-template>
                </div>
            </div>

            <!-- Backdrop to close on click outside -->
            <div *ngIf="showNotifications" class="dropdown-backdrop" (click)="closeNotifications()"></div>
        </div>

        <ad-input-switch class="me-2" [checked]="isDarkTheme" (checkedChange)="onThemeChange($event)" iconOff="fa-moon"
            iconOn="fa-sun">
        </ad-input-switch>

        <ad-input-switch class="me-2" [checked]="isItalian" (checkedChange)="onLanguageChange($event)"
            iconOff="fa-earth-europe" iconOn="fa-language">
        </ad-input-switch>

        <ad-dropdown mode="profile" [menuItems]="profileMenuItems" [profileName]="userName"
            [profileImage]="profileImageUrl">
        </ad-dropdown>
    </div>
</header>

<!-- Reset Cache Confirmation Dialog -->
<ad-dialog [(visible)]="showResetCacheDialog" [header]="isItalian ? 'Conferma Reset Cache' : 'Confirm Cache Reset'"
    [modal]="true" [style]="{width: '350px'}">
    <div class="d-flex flex-column gap-3">
        <p class="m-0">
            {{ isItalian
            ? 'Sei sicuro di voler resettare la cache? Questo canceller√† tutti i dati locali e verrai disconnesso.'
            : 'Are you sure you want to reset the cache? This will clear all local data and you will be logged out.' }}
        </p>
        <div class="d-flex justify-content-end gap-2">
            <ad-button [label]="isItalian ? 'Annulla' : 'Cancel'" severity="secondary" [outlined]="true"
                (onClick)="showResetCacheDialog = false">
            </ad-button>
            <ad-button [label]="isItalian ? 'Reset & Logout' : 'Reset & Logout'" severity="danger"
                (onClick)="onResetCacheConfirm()">
            </ad-button>
        </div>
    </div>
</ad-dialog>

<!-- Reset Password Dialog -->
<ad-dialog [(visible)]="showResetPasswordDialog" [header]="isItalian ? 'Resetta Password' : 'Reset Password'"
    [modal]="true" [style]="{width: '400px'}">
    <app-reset-password *ngIf="showResetPasswordDialog" (close)="showResetPasswordDialog = false">
    </app-reset-password>
</ad-dialog>